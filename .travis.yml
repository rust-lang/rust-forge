language: rust
# XXX: switch back to stable once Rust 1.41.0 is out
rust: beta
dist: xenial

branches:
  only:
    - master

env:
  RUSTINFRA_DEPLOY_DIR: book
  RUSTINFRA_CLOUDFRONT_DISTRIBUTION: E12A3GKHZSREHP
import:
  - rust-lang/simpleinfra/travis-configs/static-websites.yml

cache:
  directories:
    # cache: cargo
    - $HOME/.cargo
    - target
before_cache:
  - cargo install --debug cargo-cache
  - find $HOME/.cargo/bin/ ! -type d -exec strip {} \;
  - cargo cache --autoclean

before_script:
  - export CARGO_TARGET_DIR=$(pwd)/target
  # NOTE: Update mdbook in blacksmith/Cargo.toml too
  - cargo install -v --debug --locked mdbook --vers '0.3.5'
script:
  - mdbook build
  - cp website_config.json book/
